<div class="open-sidebar-button" (click)="toggleSidebar()">
  <i class="fa fa-bars"></i>
</div>

<div class="sidebar" [class.open]="isSidebarOpen">
  <h1>Date Range:</h1>
  <div class="date-range">
    <label for="startDate">Start Date:</label>
    <input type="date" id="startDate" name="startDate">
    <label for="endDate">End Date:</label>
    <input type="date" id="endDate" name="endDate">
  </div>
  <h3>Filter Options</h3>
  <form (submit)="applyFilters(); $event.preventDefault();">
    <!-- Existing filter options -->
    <div class="filter-option">
      <input type="checkbox" id="grantedCheckbox" [(ngModel)]="displayGranted" name="grantedFilter"
        (ngModelChange)="onGrantedCheckboxChange()">
      <label for="grantedCheckbox">Granted</label>
    </div>
    <div class="filter-option">
      <input type="checkbox" id="pregrantedCheckbox" [(ngModel)]="displayPregranted" name="pregrantFilter"
        (ngModelChange)="onPregrantedCheckboxChange()">
      <label for="pregrantedCheckbox">Pregranted</label>
    </div>
    <div class="filter-option">
      <input type="checkbox" id="bothCheckbox" [(ngModel)]="displayBoth" name="bothFilter"
        (ngModelChange)="onBothCheckboxChange()">
      <label for="bothCheckbox">Granted+Pregranted</label>
    </div>
  </form>
</div>



<section id="search-bar-area">
  <h1 id="logo">
    <a href="#">
    <span *ngFor="let letter of titleLetters; let i = index"
          class="letter" [class.animate]="isSearching" [style.animation-delay]="(i * 0.2) + 's'">
      {{ letter }}
    </span>
    </a>
  </h1>

  <form class="search-form" (submit)="onSubmit(); $event.preventDefault();">
    <!-- Search Input -->
    <div class="search-input-container">
      <textarea class="search-input" placeholder="Search..." [(ngModel)]="queryValue" name="queryValue" required></textarea>
      <input matInput [matDatepicker]="picker" style="display: none" [(ngModel)]="selectedDate" name="selectedDate">
      <mat-datepicker touchUi="true" #picker class="cdk-overlay-transparent-backdrop"></mat-datepicker>

      <div class="icon-buttons-container">
        <button mat-icon-button (click)="picker.open()" class="icon-button" type="button" [disabled]="isSubmitting">
          <i class="fa fa-calendar"></i>
        </button>

        <button (click)="onSubmit()" class="search-button" [disabled]="isSubmitting">
          <i class="fa fa-search"></i>
        </button>

      </div>

    </div>

  </form>

  <a (click)="routeSaved()" class="minimalistic-button">Saved</a>
</section>


<div class="pagination">
  <ul>
    <li *ngFor="let page of getPages()">
      <a href="#" [class.activePage]="page === currentPage" (click)="changePage(page); $event.preventDefault()">{{ page
        }}</a>
    </li>
  </ul>
</div>
<div class="page-container">
  <!-- Custom Sidebar for Search History -->
  <aside class="search-history-sidebar">
    <h2 class="sidebar-title">Search History</h2>
    <ul class="search-history-list">
      <li 
          *ngFor="let search of recentSearches"
          class="search-history-item" 
          [class.active]="activeSearch === search.query"
          (click)="onSearchHistoryClick(search)">
          <span class="search-history-query">{{ search.query }}</span>
          <span class="search-history-time">{{ search.timestamp | date:'shortTime' }}</span>
          <i  class="fa fa-trash-o" (click)="onDeleteSearchHistory(search.key, $event)"></i>
      </li>
  </ul>
  
  
    
    
    
  </aside>

<section class="patents-section" [class.expanded]="showResults">
  <br><br>
  <h1 class="">{{title}}</h1>
  <div *ngFor="let patent of getDisplayedResults(); let i = index" [class.saved-patent]="isSaved(patent)" class="patent-box"
    [@expandCollapse]="patent.state" (click)="togglePatent(patent)">

    <div class="similarity-badge" [style.background-color]="getSimilarityBadge(patent.similarity_score, i).color">
      <span>{{ getSimilarityBadge(patent.similarity_score, i).label }}</span>
    </div>
    <h2>{{ patent.title }} <br>
      <div *ngIf="grantedResults">{{patent.patent_id}} </div>
      <div *ngIf="pregrantedResults">{{patent.application_id}}</div>
    </h2>
    <p>{{ patent.abstract }}</p>
    <div class="more-info" *ngIf="patent.state === 'expanded'">
      <h2>Summary</h2>
      <p>{{ patent.summary }}</p>
      <h2>Claims</h2>
      <p>{{ patent.claims }}</p>

    </div>

    <div class="patent-buttons">
      <span class="patent-button" (click)="stopPropagation($event)"> Open Document </span>
      <span class="patent-button" (click)="stopPropagation($event)"><a href="https://patents.google.com/?q={{ patent.patent_id }}" target="_blank"> Google Patents</a>  </span>
      
      <span class="patent-button" (click)="stopPropagation($event)"> USPTO </span>
      <span class="patent-button" 
      (click)="toggleSavePatent(patent); stopPropagation($event)">
      {{ isPatentSaved(patent) ? 'Un-save Patent' : 'Save To List' }}
      </span>

    </div>


  </div>

</section>
